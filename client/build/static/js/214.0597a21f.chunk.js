"use strict";(self.webpackChunkvolunteer_management_client=self.webpackChunkvolunteer_management_client||[]).push([[214],{2214:(e,s,t)=>{t.r(s),t.d(s,{default:()=>i});var r=t(5043),a=t(5016),l=t(8254),n=t(579);const i=()=>{const{user:e}=(0,a.A)(),[s,t]=(0,r.useState)([]),[i,d]=(0,r.useState)(0),[c,o]=(0,r.useState)(!0),[x,m]=(0,r.useState)(null),[h,g]=(0,r.useState)(null),[u,y]=(0,r.useState)(!1);console.log("\ud83d\udd0d Current user:",e),console.log("\ud83d\udd0d User ID:",null===e||void 0===e?void 0:e.id),(0,r.useEffect)(()=>{v()},[]);const v=async()=>{try{var e;o(!0);const s=localStorage.getItem("token");console.log("\ud83d\udd0d Fetching surveys with token:",s?"exists":"missing");const r=await fetch("/api/volunteer/surveys",{headers:{Authorization:`Bearer ${s}`}});if(console.log("\ud83d\udd0d Response status:",r.status),console.log("\ud83d\udd0d Response ok:",r.ok),!r.ok){const e=await r.text();throw console.log("\ud83d\udd0d Error response:",e),new Error("Failed to fetch surveys")}const a=await r.json();console.log("\ud83d\udd0d Response data:",a),console.log("\ud83d\udd0d Surveys count:",(null===(e=a.surveys)||void 0===e?void 0:e.length)||0),console.log("\ud83d\udd0d Survey count from server:",a.surveyCount||0),t(a.surveys||[]),d(a.surveyCount||0)}catch(x){console.error("Error fetching surveys:",x),m("Failed to load surveys")}finally{o(!1)}},p=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=e=>{if(!e)return null;const s=e.match(/\(([^,]+),([^)]+)\)/);return s?[parseFloat(s[1]),parseFloat(s[2])]:null};return c?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading surveys..."})]})}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Survey Dashboard"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["Welcome, ",null===e||void 0===e?void 0:e.email]})]}),(0,n.jsxs)("button",{onClick:()=>window.location.href="/volunteer/survey/new",className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 flex items-center gap-2",children:[(0,n.jsx)(l.GGD,{className:"w-4 h-4"}),"New Survey"]})]})})}),(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600",children:(0,n.jsx)(l.JXP,{className:"w-6 h-6"})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Surveys"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i})]})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:(0,n.jsx)(l.HzC,{className:"w-6 h-6"})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"This Month"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(e=>{const s=new Date(e.survey_date),t=new Date;return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear()}).length})]})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"p-3 rounded-full bg-purple-100 text-purple-600",children:(0,n.jsx)(l.wIk,{className:"w-6 h-6"})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"This Week"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(e=>{const s=new Date(e.survey_date),t=new Date;return s>=new Date(t.getTime()-6048e5)}).length})]})]})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,n.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Recent Surveys"})}),x&&(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,n.jsx)("p",{className:"text-red-800",children:x})})}),0===s.length?(0,n.jsxs)("div",{className:"p-6 text-center",children:[(0,n.jsx)(l.JXP,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No surveys yet"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"Start by creating your first survey"}),(0,n.jsx)("button",{onClick:()=>window.location.href="/volunteer/survey/new",className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700",children:"Create Survey"})]}):(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Beggar Details"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("div",{className:"flex items-center",children:[e.beggar_photo_url&&(0,n.jsx)("img",{src:e.beggar_photo_url,alt:"Beggar",className:"w-10 h-10 rounded-full object-cover mr-3"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.beggar_name||"Unknown"}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:[e.beggar_age&&`${e.beggar_age} years`,e.beggar_gender&&` \u2022 ${e.beggar_gender}`]})]})]})}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,n.jsx)("div",{className:"text-sm text-gray-900",children:e.location_address||"Location recorded"}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:(()=>{const s=j(e.location_coordinates);return s?`${s[0].toFixed(4)}, ${s[1].toFixed(4)}`:"Coordinates available"})()})]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p(e.survey_date)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{onClick:()=>{g(e),y(!0)},className:"text-blue-600 hover:text-blue-900",children:(0,n.jsx)(l.Vap,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:()=>window.location.href=`/volunteer/survey/edit/${e.id}`,className:"text-green-600 hover:text-green-900",children:(0,n.jsx)(l.SG1,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this survey?"))try{if(!(await fetch(`/api/volunteer/surveys/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete survey");t(s.filter(s=>s.id!==e)),d(e=>e-1)}catch(x){console.error("Error deleting survey:",x),alert("Failed to delete survey")}})(e.id),className:"text-red-600 hover:text-red-900",children:(0,n.jsx)(l.IXo,{className:"w-4 h-4"})})]})})]},e.id))})]})})]})]}),u&&h&&(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,n.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Survey Details"}),(0,n.jsx)("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[h.beggar_photo_url&&(0,n.jsx)("div",{children:(0,n.jsx)("img",{src:h.beggar_photo_url,alt:"Beggar",className:"w-full h-48 object-cover rounded-lg"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:"Beggar Information"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["Name: ",h.beggar_name||"Unknown",(0,n.jsx)("br",{}),"Age: ",h.beggar_age||"Unknown",(0,n.jsx)("br",{}),"Gender: ",h.beggar_gender||"Unknown"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:"Location"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:[h.location_address||"Address not provided",(0,n.jsx)("br",{}),(()=>{const e=j(h.location_coordinates);return e?`Coordinates: ${e[0].toFixed(6)}, ${e[1].toFixed(6)}`:"Coordinates not available"})()]})]}),h.survey_notes&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:"Notes"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:h.survey_notes})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-gray-900",children:"Survey Date"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:p(h.survey_date)})]})]}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Close"}),(0,n.jsx)("button",{onClick:()=>{y(!1),window.location.href=`/volunteer/survey/edit/${h.id}`},className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700",children:"Edit"})]})]})})})]})}}}]);
//# sourceMappingURL=214.0597a21f.chunk.js.map